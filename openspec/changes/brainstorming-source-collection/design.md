# Design: Brainstorming Source Collection Phase

## Architecture Decision: Source Collection Before Design

### Context

The brainstorming skill currently jumps directly into design exploration. In real-world team workflows, requirements come from multiple sources:
- **Jira**: Original requirement tickets and PRD descriptions
- **Apifox**: Backend API contracts and documentation
- **Figma**: UI/UX designs and specifications

### Decision

**Add a source collection phase when `/superpowers:brainstorm` is invoked without arguments.**

### Trigger Condition

```
/superpowers:brainstorm        → Trigger source collection
/superpowers:brainstorm <text> → Skip to normal brainstorming
```

### Collection Flow

```
┌─────────────────────────────────────────┐
│  No arguments detected                  │
└─────────────────┬───────────────────────┘
                  ▼
┌─────────────────────────────────────────┐
│  AskUserQuestion: Collect sources       │
│  - Jira URL (optional)                  │
│  - API URL (can skip)                   │
│  - Figma URL (can skip)                 │
└─────────────────┬───────────────────────┘
                  ▼
┌─────────────────────────────────────────┐
│  If no Jira: Ask for manual description │
│  - What problem to solve?               │
│  - Expected functionality?              │
└─────────────────┬───────────────────────┘
                  ▼
┌─────────────────────────────────────────┐
│  Call MCP services (if URLs provided)   │
│  - apifox-mcp → API summary             │
│  - figmap-mcp → Design summary          │
│  - On failure: Log reason, continue     │
└─────────────────┬──────────────────��────┘
                  ▼
┌─────────────────────────────────────────┐
│  Create sources.md                      │
│  Path: openspec/changes/<feature>/      │
└─────────────────┬───────────────────────┘
                  ▼
┌─────────────────────────────────────────┐
│  Enter normal brainstorming flow        │
│  (with collected context)               │
└─────────────────────────────────────────┘
```

### sources.md Structure

```markdown
# <Feature Name> - Sources

## Information Sources

| Type | Link |
|------|------|
| Jira | <url or "Not provided"> |
| API (Apifox) | <url or "Not provided"> |
| Figma | <url or "Not provided"> |

## PRD Description

<Description from Jira or manually provided by user>

## API Summary

> Source: apifox-mcp

<API summary or "⚠️ Failed to fetch - <reason>">

## Design Summary

> Source: figmap-mcp

<Design summary or "⚠️ Failed to fetch - <reason>">

---
*This file is auto-generated by brainstorming skill for document consistency verification*
```

### Key Design Decisions

| Decision Point | Choice | Rationale |
|----------------|--------|-----------|
| Trigger condition | No arguments only | Don't interrupt users who already have clear requirements |
| Jira requirement | Optional with fallback | Allow manual description for flexibility |
| API/Figma requirement | Fully optional | Not all features need both |
| MCP failure handling | Graceful degradation | Don't block workflow on external service failures |
| MCP call timing | Immediately after collection | Provide full context before brainstorming starts |

### Trade-offs

**Advantages:**
- Structured requirement collection
- Automatic context gathering via MCP
- Single source of truth in sources.md
- Supports consistency verification

**Disadvantages:**
- Additional step for simple brainstorming
- Depends on MCP services availability
- Requires users to have URLs ready
